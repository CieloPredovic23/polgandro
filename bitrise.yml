format_version: 7
default_step_lib_source: https://github.com/bitrise-io/bitrise-steplib.git
project_type: other

app:
  envs:
  - BIN_NAME: bitrise

workflows:
  test:
    title: Runs tests
    steps:
    - script:
        title: Go test
        inputs:
        - content: go test $BITRISE_GO_PACKAGES
    - script:
        title: Run integration tests
        inputs:
        - content: |-
            #!/usr/bin/env bash
            go run . -- run noop

  create-binaries:
    title: Create binaries
    description: |
        Creates Linux and Darwin binaries
    steps:
    - script:
        title: Create binaries
        inputs:
        - content: |
            #!/usr/bin/env bash
            set -e
            set -x

  dep-update:
    title: Dep update
    description: |
      Used for updating bitrise dependencies with dep
    steps:
    - script:
        title: Dependency update
        inputs:
        - content: |-
            #!/usr/bin/env bash

  noop:
    title: Noop
    description: Empty workflow for quick testing

  fail-test:
    title: Fails
    description: Workflow will fail
    steps:
    - script:
        title: Success
        inputs:
        - content: exit 0
    - script:
        title: Fail wit exit code 2
        inputs:
        - content: exit 2
    - script:
        title: Skippable fail with exit code 2
        is_always_run: true
        is_skippable: true
        inputs:
        - content: exit 2
    - script:
        title: Skipping success
        is_always_run: false
        inputs:
        - content: exit 0
